<?xml version="1.0" encoding="UTF-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
 auto-import="true" assembly="Vodovoz" namespace="Vodovoz.Domain">

 	<!--Простые справочники-->

 	<class name="CounterpartyStatus" lazy="false" table="status">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
		<property name="Name" column="name" />
	</class>

	<class name="CullingCategory" lazy="false" table="culling_category">
		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
		<property name="Name" column="name" />
	</class>

	<class name="EquipmentColors" lazy="false" table="equipment_colors">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
 	</class>

	<class name="EquipmentType" lazy="false" table="equipment_type">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
 	</class>

 	<class name="LogisticsArea" lazy="false" table="logistics_area">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
 	</class>

	<class name="Manufacturer" lazy="false" table="manufacturers">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
 	</class>

	<class name="Nationality" lazy="false" table="nationality">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
 	</class>

 	<class name="NomenclaturePrice" lazy="false" table="nomenclature_price">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="MinCount" column="min_count" />
	 	<property name="Price" column="price" />
 	</class>

	<class name="Significance" lazy="false" table="significance">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
		<property name="Name" column="name" />
	</class>

	<!--Прочие справочники-->

	<class name="AdditionalAgreement" lazy="false" table="additional_agreements">
		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
		<discriminator column="type" type="String"/>
		<property name="AgreementNumber" column="number" />
		<property name="StartDate" column="start_date" />
		<property name="IssueDate" column="issue_date" /> 
		<many-to-one name="Contract" class="CounterpartyContract" column="counterparty_contract_id" />
		<many-to-one name="DeliveryPoint" class="DeliveryPoint" column="delivery_point_id" />
		<subclass name="NonfreeRentAgreement" discriminator-value="NonfreeRent">
			<bag name="Equipment" inverse="false" cascade="all-delete-orphan" lazy="true" >
    			<key column="additional_agreement_id"/>
    			<one-to-many class="PaidRentEquipment"/>	
			</bag>
        </subclass>
        <subclass name="DailyRentAgreement" discriminator-value="DailyRent">
			<bag name="Equipment" inverse="false" cascade="all-delete-orphan" lazy="true" >
    			<key column="additional_agreement_id"/>
    			<one-to-many class="PaidRentEquipment"/>	
			</bag>
			<property name="RentDays" column="rent_days" />
        </subclass>
    	<subclass name="FreeRentAgreement" discriminator-value="FreeRent">
    		<bag name="Equipment" inverse="false" cascade="all-delete-orphan" lazy="true" >
    			<key column="additional_agreement_id"/>
    			<one-to-many class="FreeRentEquipment"/>
			</bag>
        </subclass>
    	<subclass name="WaterSalesAgreement" discriminator-value="WaterSales">
    		<property name="IsFixedPrice" column="water_is_fixed_price" />
    		<property name="FixedPrice" column="water_fixed_price" />
        </subclass>
        <subclass name="RepairAgreement" discriminator-value="Repair">
        </subclass>
	</class>

 	<class name="CommentTemplate" lazy="false" table="comment_templates">
 		<id name="Id" column="id">
 			<generator class="native"/>
 		</id>
 		<property name="Comment" column="comment" />
 	</class>

 	<class name="Contact" lazy="false" table="counterparty_contacts">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
		<property name="Name" column="name" />
		<property name="Surname" column="surname" />
		<property name="Lastname" column="lastname" />
		<property name="Comment" column="comment" /> 
		<property name="Fired" column="fired" />
		<many-to-one name="Post" class="QSContacts.Post" column="post_id" />
		<many-to-one name="Counterparty" class="Counterparty" column="counterparty_id"/>
		<bag name="Phones" inverse="false" cascade="all-delete-orphan" lazy="true" >
    		<key column="counterparty_contact_id"/>
    		<one-to-many class="QSContacts.Phone" />
		</bag>
		<bag name="Emails" inverse="false" cascade="all-delete-orphan" lazy="true" >
    		<key column="counterparty_contact_id"/>
    		<one-to-many class="QSContacts.Email" />
		</bag>
		<bag name="DeliveryPoints" inverse="true" lazy="true" >
    		<key column="contact_person_id"/>
    		<one-to-many class="DeliveryPoint" />
		</bag>
	</class>

 	<class name="CounterpartyContract" lazy="false" table="counterparty_contract">
		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
		<property name="MaxDelay" column="max_delay" />
		<property name="IssueDate" column="issue_date" /> 
		<property name="IsArchive" column="is_archive" /> 
		<property name="OnCancellation" column="on_cancellation" /> 
		<many-to-one name="Organization" class="Organization" column="organization_id"/>
		<many-to-one name="Counterparty" class="Counterparty" column="counterparty_id"/>
		<bag name="AdditionalAgreements" inverse="false" cascade="all-delete-orphan" lazy="true" >
    		<key column="counterparty_contract_id"/>
    		<one-to-many class="AdditionalAgreement" />
		</bag>
	</class>

	<class name="DeliverySchedule" lazy="false" table="delivery_schedule">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
 		<property name="Name" column="name" />
 		<property name="From" column="from_time" type="DataAccess.NhibernateFixes.TimeAsTimeSpanTypeClone, Vodovoz"/>
 		<property name="To" column="to_time" type="DataAccess.NhibernateFixes.TimeAsTimeSpanTypeClone, Vodovoz"/>
 	</class>

	<class name="Employee" lazy="false" table="employees">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
	 	<property name="LastName" column="last_name" />
	 	<property name="Patronymic" column="patronymic" />
	 	<property name="Category" column="category" type="EmployeeCategoryStringType, Vodovoz"/>
	 	<property name="PassportSeria" column="passport_seria" />
	 	<property name="PassportNumber" column="passport_number" />
	 	<property name="DrivingNumber" column="driving_number" />
	 	<property name="Photo" column="photo" type="BinaryBlob" />
	 	<property name="AddressRegistration" column="address_registration" />
	 	<property name="AddressCurrent" column="address_current" />
	 	<property name="IsFired" column="is_fired" />
	 	<many-to-one name="Nationality" class="Nationality" column="nationality_id" />
	 	<many-to-one name="User" class="User" column="user_id" />
	 	<bag name="Phones" inverse="false" cascade="all-delete-orphan" lazy="true" >
    		<key column="employee_id"/>
    		<one-to-many class="QSContacts.Phone" />
		</bag>
 	</class>

 	<class name="Equipment" lazy="false" table="equipment">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
 		<!--<property name="Serial" column="serial_number" />-->
 		<property name="LastServiceDate" column="last_service_date" />
		<property name="WarrantyEndDate" column="warranty_end_date" /> 
		<property name="OnDuty" column="on_duty" />
		<property name="Comment" column="comment" />
		<many-to-one name="Nomenclature" class="Nomenclature" column="nomenclature_id" />
 	</class>

 	<class name="FreeRentEquipment" lazy="false" table="free_rent_equipment">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
 		<property name="Deposit" column="deposit" />
 		<property name="WaterAmount" column="water_amount" />
 		<many-to-one name="FreeRentPackage" class="FreeRentPackage" column="free_rent_package_id" />
 		<many-to-one name="Equipment" class="Equipment" column="equipment_id" />
 	</class>

 	<class name="FreeRentPackage" lazy="false" table="free_rent_packages">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
		<property name="Name" column="name" />
		<property name="MinWaterAmount" column="min_water_amount" />
		<property name="Deposit" column="deposit" />
		<many-to-one name="EquipmentType" class="EquipmentType" column="equipment_type_id"/>
		<many-to-one name="DepositService" class="Nomenclature" column="deposit_service_id" />
	</class>

	<class name="ProductSpecification" lazy="false" table="specification_production">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
	 	<many-to-one name="Product" class="Nomenclature" column="nomenclature_id" />
	 	<bag name="Materials" inverse="false" cascade="all-delete-orphan" lazy="false" >
    		<key column="specification_production_id" not-null="true"/>
    		<one-to-many class="ProductSpecificationMaterial" />
		</bag>
 	</class>

	<class name="ProductSpecificationMaterial" lazy="false" table="specification_production_materials">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<many-to-one name="Material" class="Nomenclature" column="nomenclature_id" />
	 	<property name="Amount" column="amount"/>
 	</class>

	<class name="Organization" lazy="false" table="organizations">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
	 	<property name="FullName" column="full_name" />
	 	<property name="INN" column="INN" />
	 	<property name="KPP" column="KPP" />
	 	<property name="OGRN" column="OGRN" />
	 	<property name="Email" column="email" />
	 	<property name="Address" column="address" />
	 	<property name="JurAddress" column="jur_address" />
	 	<many-to-one name="Leader" class="Employee" column="leader_id" />
	 	<many-to-one name="Buhgalter" class="Employee" column="buhgalter_id" />
	 	<many-to-one name="DefaultAccount" class="QSBanks.Account" column="default_account_id" />
	 	<bag name="Accounts" inverse="false" cascade="all-delete-orphan" lazy="true" >
    		<key column="org_id"/>
    		<one-to-many class="QSBanks.Account" />
		</bag>
	 	<bag name="Phones" inverse="false" cascade="all-delete-orphan" lazy="true" >
    		<key column="org_id"/>
    		<one-to-many class="QSContacts.Phone" />
		</bag>
 	</class>

 	<class name="PaidRentEquipment" lazy="false" table="paid_rent_equipment">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
 		<property name="Price" column="price" />
 		<property name="Deposit" column="deposit" />
 		<many-to-one name="PaidRentPackage" class="PaidRentPackage" column="paid_rent_package_id" />
 		<many-to-one name="Equipment" class="Equipment" column="equipment_id" />
 	</class>

 	<class name="PaidRentPackage" lazy="false" table="paid_rent_packages">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
		<property name="Name" column="name" />
		<property name="PriceDaily" column="price_daily" />
		<property name="PriceMonthly" column="price_monthly" />
		<property name="Deposit" column="deposit" />
		<many-to-one name="EquipmentType" class="EquipmentType" column="equipment_type_id"/>
		<many-to-one name="RentServiceDaily" class="Nomenclature" column="rent_service_daily_id"/>
		<many-to-one name="RentServiceMonthly" class="Nomenclature" column="rent_service_monthly_id"/>
		<many-to-one name="DepositService" class="Nomenclature" column="deposit_service_id" />
	</class>

 	<class name="Proxy" lazy="false" table="counterparty_proxies">
 		<id name="Id" column="id">
 			<generator class="native"></generator>
 		</id>
 		<many-to-one name="Counterparty" class="Counterparty" column="counterparty_id"/>
		<property name="Number" column="number" />
		<property name="IssueDate" column="issue_date" />
		<property name="StartDate" column="start_date" /> 
		<property name="ExpirationDate" column="expiration_date" />
		<many-to-one name="DeliveryPoint" class="DeliveryPoint" column="delivery_point_id" />
		<bag name="Persons" inverse="false" cascade="all-delete-orphan" lazy="true" >
    		<key column="counterparty_proxy_id"/>
    		<one-to-many class="QSContacts.Person" />
		</bag>
	</class>

	<class name="User" lazy="false" table="users">
		<id name="Id" column="id">
			<generator class="native"></generator>
	 	</id>
	 	<property name="Name" column="name" />
	 	<property name="Login" column="login" />
 	</class>

</hibernate-mapping>
